# 窃电分析设计说明
## 功能实现方案
### 算法原理
一般表后窃电或者用电异常时，电能表的计量值与真实值近似满足比例关系，因此，给定表箱内子表和量测开关抄读值x、y，二者满足如下等式
 $$ y=δ+\sum_{i=1}^{m}(1+β_i)x_i  $$
其中$δ$代表固定损耗， $β_i$表示子表的异常或窃电系数，m表示表箱内子表的个数。等式两边同时减去子表的加和得到
$$\hat{β} = min||y^{error} - Xβ||_2^2$$
对于含有 m 个子表的表箱，采集 n 天的电量数据，则求解子表的异常或窃电系数相当于求解以下方程组
$$
\begin{cases}
\begin{aligned}
x_{11}β_{1} + x_{12}β_{2} + &\cdots& x_{1m}β_{m} + δ_{1}= y_{1}^{error}\\
x_{21}β_{1} + x_{22}β_{2} + &\cdots& x_{2m}β_{m} + δ_{2}= y_{2}^{error}\\
\vdots&\\
x_{t1}β_{1} + x_{t2}β_{2} + &\cdots& x_{tm}β_{m} + δ_{t}= y_{t}^{error}\\
\vdots&\\
x_{n1}β_{1} + x_{n2}β_{2} + &\cdots& x_{nm}β_{m} + δ_{n}= y_{n}^{error}\\
\end{aligned}
\end{cases}
$$
的解$β_{1}$,$β_{2}$,⋯,$β_{m}$,。按照解是否超过规约的阈值确定用电异常电能表或窃电表。
### 窃电分析和用电异常电能表识别流程
功能具备窃电分析功能：开关应主动搜表后抄表，滑差抄录电能表电能并比对自身电能，如果量测开关内电能>误差超过设定阈值会主动上报事件。

当大于窃电事件阈值时，即识别到有窃电事件后会主动上报。对于表前私搭线窃电，电表数据中无法体现，算法无法检测。对于表后窃电，算法可定位到窃电表计，同时上报窃电表地址。
当大于用电异常电能表识别事件阈值时且小于窃电事件阈值时，即识别到用电异常电能表事件后会主动上报，同时上报异常电能表地址。

应用条件: 由于算法是基于一段时间用户用电数据，以数据分析手段定位，为保证检测效果。首先需要用户有一定的用电量或功率特征，日用电量>1.5度电或用电高峰期有功功率＞300W。其次，需要一定的有效计算点数，一般来说，计算点数（n）应大于量测开关所带电表数目（m）的两倍，即n＞2m。

另外，用电异常电能表识别，目前算法支持电能表误差监测。客户对概念定义需明确。
### 功能现场实现方案

![image](http://172.17.0.100:8080/wangrui/lc_manage_project_new/-/raw/master/doc/figures/51.png?inline=false)

## 台体检测方案
由于送检过程，利用日冻结电量数据周期过长，需要提供一套快速检测方案。将数据项更换为有功功率，这样即可满足短时间内（1小时内）完成检测流程。具体检测方案如下：
1.	测试准备
表箱构成：设置12块虚拟电表模拟表箱；
负载构成：添加常用电器作为负载，例如热水壶、电暖风、风扇、吹风机等；
2.	采集配置
（1）测试前进行时钟同步，误差在3s内。
（2）配置1min有功功率抄读任务。
（3）每隔1min~2min进行负荷随机切换。
（4）采集数据点数大于20。
3.	窃电分析检测的参数配置
随机抽取1~2块虚拟电表，台体对其数据进行模拟窃电处理，即乘以常数α（0.2~0.5之间的某个数）。
4.	用电异常电能表识别的参数配置
随机抽取1~2块虚拟电表，台体对其数据进行模拟异常处理，即乘以常数α（0.90~0.95或1.05~1.10之间的某个数）。
5.	检测达标条件
（1）窃电分析功能
线损率超过窃电时间上报阈值（可设置）进行窃电分析，智能量测开关计算后输出模拟的窃电表序号。
（2）用电异常电能表识别功能
线损率大于用电异常电能表识别事件阈值且低于窃电时间上报阈值（可设置）进行用电异常电能表识别分析，智能量测开关计算后输出模拟的用电异常电表序号。
## 应用案例
### 异常用电应用案例
![image](http://172.17.0.100:8080/wangrui/lc_manage_project_new/-/raw/master/doc/figures/52.png?inline=false)
### 窃电应用案例
![image](http://172.17.0.100:8080/wangrui/lc_manage_project_new/-/raw/master/doc/figures/53.png?inline=false)
![image](http://172.17.0.100:8080/wangrui/lc_manage_project_new/-/raw/master/doc/figures/54.png?inline=false)